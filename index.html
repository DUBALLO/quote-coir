<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보행매트 견적 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
        }
        .quote-container {
            background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        .header-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        }
        .result-container {
            transition: all 0.3s ease;
        }
        .customer-info-box {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .validation-error {
            color: #dc2626;
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 4px;
            display: none;
        }
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            .container {
                max-width: 100% !important;
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .print-container {
                padding: 20px;
                box-shadow: none !important;
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
            }
            .print-break-inside-avoid {
                break-inside: avoid;
            }
            @page {
                size: A4;
                margin: 10mm;
            }
        }
        .print-only {
            display: none;
        }
        
        #printFrame {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="header-bg rounded-t-lg p-6 text-white no-print">
            <h1 class="text-3xl font-bold text-center">보행매트 견적 계산기</h1>
            <p class="text-center mt-2 opacity-90">원하시는 규격과 수량을 입력하시면 즉시 견적을 확인하실 수 있습니다</p>
        </div>
        
        <div class="quote-container rounded-b-lg p-6 mb-8 no-print">
            <div id="matSelections">
                <div class="mat-selection border-b pb-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-800">매트 #1</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label for="thickness-0" class="block text-sm font-medium text-gray-700 mb-1">두께 선택</label>
                                <select id="thickness-0" class="thickness w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                    <option value="30">30mm</option>
                                    <option value="35">35mm</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="width-0" class="block text-sm font-medium text-gray-700 mb-1">폭 선택 (mm)</label>
                                <select id="width-0" class="width w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                    <option value="600">600mm</option>
                                    <option value="800">800mm</option>
                                    <option value="1000" selected>1000mm</option>
                                    <option value="1200">1200mm</option>
                                    <option value="1500">1500mm</option>
                                    <option value="1800">1800mm (30mm 두께만)</option>
                                    <option value="2000">2000mm</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="type-0" class="block text-sm font-medium text-gray-700 mb-1">타입 선택</label>
                                <select id="type-0" class="type w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                    <option value="DB">일반형 (DB)</option>
                                    <option value="DBM">경사형 (DBM) - 1000~1500mm만 가능</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="length-0" class="block text-sm font-medium text-gray-700 mb-1">길이 (m)</label>
                                <input type="number" id="length-0" class="length w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" min="1" value="1">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mb-6">
                <button id="addMatBtn" class="flex items-center bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    매트 추가하기
                </button>
            </div>
            
            <div class="border-t pt-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">추가 부속품 (고정핀, 권장수량 m당 2개)</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <input type="number" id="accessory1" min="0" value="0" class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <label for="accessory1" class="ml-2 text-sm text-gray-600">철판 (15×200×t1mm) <span class="text-gray-500">- 부드러운 지반에 사용</span></label>
                    </div>
                    <div class="flex items-center">
                        <input type="number" id="accessory2" min="0" value="0" class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <label for="accessory2" class="ml-2 text-sm text-gray-600">철근 (Φ10×250mm) <span class="text-gray-500">- 암석 지반에 사용</span></label>
                    </div>
                    <div class="flex items-center">
                        <input type="number" id="accessory3" min="0" value="0" class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <label for="accessory3" class="ml-2 text-sm text-gray-600">철근 (Φ10×300mm) <span class="text-gray-500">- 암석 지반에 사용</span></label>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <button id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-md transition duration-200 ease-in-out transform hover:scale-[1.02]">
                    견적 계산하기
                </button>
            </div>
        </div>
        
        <div id="resultContainer" class="result-container bg-white rounded-lg p-6 shadow-md hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">견적 결과</h2>
            
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-md print-break-inside-avoid">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2">품목</th>
                                <th class="text-left py-2">물품식별번호</th>
                                <th class="text-left py-2">규격</th>
                                <th class="text-right py-2">단가</th>
                                <th class="text-right py-2">수량</th>
                                <th class="text-right py-2">금액</th>
                            </tr>
                        </thead>
                        <tbody id="quoteItems">
                            <!-- Items will be inserted here -->
                        </tbody>
                        <tfoot>
                            <tr class="border-t">
                                <td colspan="5" class="text-right py-3 font-medium">총 견적 금액</td>
                                <td id="totalAmount" class="text-right py-3 font-bold text-blue-700">-</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="text-sm text-gray-500">
                    <p>※ 인도조건: 납품장소 하차도</p>
                    <p>※ 부가세 포함</p>
                    <p>※ 견적 유효기간: <span id="expiryDate">2025년 8월 17일</span>까지</p>
                </div>
                
                <!-- 견적요청자 정보 입력 폼 -->
                <div class="customer-info-box no-print">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">견적요청자 정보</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">고객명(기관명) *</label>
                            <input type="text" id="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="예: 홍길동 또는 ㈜두발로" minlength="2" maxlength="50">
                        </div>
                        <div>
                            <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">연락처 *</label>
                            <input type="tel" id="customerPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="예: 010-1234-5678" pattern="(01[016789]|02|0[3-9][0-9])-[0-9]{3,4}-[0-9]{4}">
                        </div>
                        <div>
                            <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">이메일 *</label>
                            <input type="email" id="customerEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="예: contact@company.com" required>
                        </div>
                    </div>
                    <div id="validationError" class="validation-error">
                        고객명과 연락처를 기재하세요
                    </div>
                </div>
                
                <div class="mt-4 no-print">
                    <button id="emailBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md mr-2">
                        견적서 이메일 발송
                    </button>
                    <button id="newQuoteBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md">
                        새 견적 작성
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 제품 데이터 - 완전한 버전
        const products = [
            { id: "DB-600", code: "24383984", thickness: 30, width: 600, type: "DB", price: 17500, spec: "600 × t30mm" },
            { id: "DB-800", code: "24383985", thickness: 30, width: 800, type: "DB", price: 18900, spec: "800 × t30mm" },
            { id: "DB-1000", code: "23820461", thickness: 30, width: 1000, type: "DB", price: 20500, spec: "1000 × t30mm" },
            { id: "DB-1200", code: "23820462", thickness: 30, width: 1200, type: "DB", price: 25000, spec: "1200 × t30mm" },
            { id: "DB-1500", code: "23816090", thickness: 30, width: 1500, type: "DB", price: 32000, spec: "1500 × t30mm" },
            { id: "DB-1800", code: "24383986", thickness: 30, width: 1800, type: "DB", price: 42900, spec: "1800 × t30mm" },
            { id: "DB-2000", code: "24383987", thickness: 30, width: 2000, type: "DB", price: 45000, spec: "2000 × t30mm" },
            { id: "DBM-1000", code: "24022659", thickness: 30, width: 1000, type: "DBM", price: 34500, spec: "1000 × t30mm" },
            { id: "DBM-1200", code: "24022658", thickness: 30, width: 1200, type: "DBM", price: 37000, spec: "1200 × t30mm" },
            { id: "DBM-1500", code: "24022657", thickness: 30, width: 1500, type: "DBM", price: 47900, spec: "1500 × t30mm" },
            { id: "DB-3506", code: "25217275", thickness: 35, width: 600, type: "DB", price: 17900, spec: "600 × t35mm" },
            { id: "DB-3508", code: "25217276", thickness: 35, width: 800, type: "DB", price: 18900, spec: "800 × t35mm" },
            { id: "DB-3510", code: "25150092", thickness: 35, width: 1000, type: "DB", price: 21900, spec: "1000 × t35mm" },
            { id: "DB-3512", code: "25150093", thickness: 35, width: 1200, type: "DB", price: 25900, spec: "1200 × t35mm" },
            { id: "DB-3515", code: "25150094", thickness: 35, width: 1500, type: "DB", price: 32900, spec: "1500 × t35mm" },
            { id: "DB-3520", code: "25150095", thickness: 35, width: 2000, type: "DB", price: 49900, spec: "2000 × t35mm" }
        ];

        // 부속품 데이터 - 완전한 버전
        const accessories = [
            { id: "DB-P1", code: "23816084", name: "철판 (15×200×t1mm)", price: 250, note: "부드러운 지반에 사용" },
            { id: "DB-P2", code: "23816086", name: "철근 (Φ10×250mm)", price: 600, note: "암석 지반에 사용" },
            { id: "DB-P3", code: "25488231", name: "철근 (Φ10×300mm)", price: 500, note: "암석 지반에 사용" }
        ];

        // 현재 매트 선택 수
        let matCount = 1;

        // 폼 요소들
        const calculateBtn = document.getElementById('calculateBtn');
        const resultContainer = document.getElementById('resultContainer');
        const quoteItems = document.getElementById('quoteItems');
        const totalAmount = document.getElementById('totalAmount');
        const emailBtn = document.getElementById('emailBtn');
        const newQuoteBtn = document.getElementById('newQuoteBtn');
        const quoteDate = document.getElementById('quoteDate');
        const expiryDate = document.getElementById('expiryDate');
        const addMatBtn = document.getElementById('addMatBtn');

        // 현재 날짜 설정 및 유효기간 계산
        const today = new Date();
        const oneMonthLater = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
        
        if (quoteDate) quoteDate.textContent = `${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`;
        if (expiryDate) expiryDate.textContent = `${oneMonthLater.getFullYear()}년 ${oneMonthLater.getMonth() + 1}월 ${oneMonthLater.getDate()}일`;

        // 타입 선택에 따른 폭 옵션 필터링
        function updateWidthOptions(index) {
            const thicknessSelect = document.getElementById(`thickness-${index}`);
            const typeSelect = document.getElementById(`type-${index}`);
            const widthSelect = document.getElementById(`width-${index}`);
            
            if (!thicknessSelect || !typeSelect || !widthSelect) return;
            
            const thickness = parseInt(thicknessSelect.value);
            const type = typeSelect.value;
            
            // 기존 옵션 제거
            while (widthSelect.options.length > 0) {
                widthSelect.remove(0);
            }
            
            // 필터링된 제품 목록
            const filteredProducts = products.filter(p => p.thickness === thickness && p.type === type);
            
            if (filteredProducts.length === 0) {
                // 해당 조건의 제품이 없는 경우
                if (type === "DBM") {
                    alert("경사형(DBM)은 30mm 두께의 1000~1500mm 폭 제품만 가능합니다.");
                    typeSelect.value = "DB";
                    updateWidthOptions(index);
                    return;
                }
                
                // 일반 제품 목록 표시
                products.filter(p => p.thickness === thickness && p.type === "DB")
                    .forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.width;
                        option.textContent = `${product.width}mm`;
                        // 1000mm를 기본 선택으로 설정
                        if (product.width === 1000) {
                            option.selected = true;
                        }
                        widthSelect.appendChild(option);
                    });
            } else {
                // 필터링된 제품 목록 표시
                filteredProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.width;
                    option.textContent = `${product.width}mm`;
                    // 1000mm를 기본 선택으로 설정
                    if (product.width === 1000) {
                        option.selected = true;
                    }
                    widthSelect.appendChild(option);
                });
            }
        }

        // 초기 이벤트 리스너 설정
        document.getElementById('thickness-0').addEventListener('change', function() {
            updateWidthOptions(0);
        });
        
        document.getElementById('type-0').addEventListener('change', function() {
            updateWidthOptions(0);
        });

        // 초기 폭 옵션 설정
        updateWidthOptions(0);

        // 새 매트 선택 추가
        function addNewMatSelection() {
            const matSelections = document.getElementById('matSelections');
            const newMatIndex = matSelections.children.length; // 0부터 시작하도록 변경
            const displayIndex = newMatIndex + 1; // 화면 표시용
            
            const matDiv = document.createElement('div');
            matDiv.className = 'mat-selection border-b pb-6 mb-6';
            matDiv.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-800">매트 #${displayIndex}</h3>
                    <button class="remove-mat text-red-500 hover:text-red-700" data-index="${newMatIndex}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label for="thickness-${newMatIndex}" class="block text-sm font-medium text-gray-700 mb-1">두께 선택</label>
                            <select id="thickness-${newMatIndex}" class="thickness w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="30">30mm</option>
                                <option value="35">35mm</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="width-${newMatIndex}" class="block text-sm font-medium text-gray-700 mb-1">폭 선택 (mm)</label>
                            <select id="width-${newMatIndex}" class="width w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="600">600mm</option>
                                <option value="800">800mm</option>
                                <option value="1000" selected>1000mm</option>
                                <option value="1200">1200mm</option>
                                <option value="1500">1500mm</option>
                                <option value="1800">1800mm (30mm 두께만)</option>
                                <option value="2000">2000mm</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="type-${newMatIndex}" class="block text-sm font-medium text-gray-700 mb-1">타입 선택</label>
                            <select id="type-${newMatIndex}" class="type w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="DB">일반형 (DB)</option>
                                <option value="DBM">경사형 (DBM) - 1000~1500mm만 가능</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="length-${newMatIndex}" class="block text-sm font-medium text-gray-700 mb-1">길이 (m)</label>
                            <input type="number" id="length-${newMatIndex}" class="length w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" min="1" value="1">
                        </div>
                    </div>
                </div>
            `;
            
            matSelections.appendChild(matDiv);
            matCount++;
            
            // 삭제 버튼에 이벤트 리스너 추가
            const removeBtn = matDiv.querySelector('.remove-mat');
            removeBtn.addEventListener('click', function() {
                matDiv.remove();
            });
            
            // 새로 추가된 선택에 이벤트 리스너 추가
            const thicknessSelect = document.getElementById(`thickness-${newMatIndex}`);
            const typeSelect = document.getElementById(`type-${newMatIndex}`);
            
            if (thicknessSelect) {
                thicknessSelect.addEventListener('change', function() {
                    updateWidthOptions(newMatIndex);
                });
            }
            
            if (typeSelect) {
                typeSelect.addEventListener('change', function() {
                    updateWidthOptions(newMatIndex);
                });
            }
            
            // 초기 폭 옵션 설정
            updateWidthOptions(newMatIndex);
        }

        // 매트 추가 버튼 이벤트
        addMatBtn.addEventListener('click', addNewMatSelection);

        // 견적 계산
        function calculateQuote() {
            // 견적 항목 초기화
            quoteItems.innerHTML = '';
            
            let total = 0;
            
            // 모든 매트 선택 처리
            const matSelections = document.querySelectorAll('.mat-selection');
            
            for (let i = 0; i < matSelections.length; i++) {
                const thicknessSelect = document.getElementById(`thickness-${i}`);
                const widthSelect = document.getElementById(`width-${i}`);
                const typeSelect = document.getElementById(`type-${i}`);
                const lengthInput = document.getElementById(`length-${i}`);
                
                // 요소가 존재하는지 확인
                if (!thicknessSelect || !widthSelect || !typeSelect || !lengthInput) continue;
                
                const thickness = parseInt(thicknessSelect.value);
                const width = parseInt(widthSelect.value);
                const type = typeSelect.value;
                const length = parseInt(lengthInput.value);
                
                // 선택한 제품 찾기
                const product = products.find(p => 
                    p.thickness === thickness && 
                    p.width === width && 
                    p.type === type
                );
                
                if (!product) {
                    alert(`매트 #${i+1}: 선택한 조건에 맞는 제품이 없습니다. 다른 조건을 선택해주세요.`);
                    return;
                }
                
                // 매트 항목 추가
                addQuoteItem(product.id, product.code, "보행매트", product.spec, product.price, length);
                total += product.price * length;
            }
            
            // 부속품 처리
            const accessory1Qty = parseInt(document.getElementById('accessory1').value);
            const accessory2Qty = parseInt(document.getElementById('accessory2').value);
            const accessory3Qty = parseInt(document.getElementById('accessory3').value);
            
            if (accessory1Qty > 0) {
                addQuoteItem(accessories[0].id, accessories[0].code, accessories[0].name, "-", accessories[0].price, accessory1Qty);
                total += accessories[0].price * accessory1Qty;
            }
            
            if (accessory2Qty > 0) {
                addQuoteItem(accessories[1].id, accessories[1].code, accessories[1].name, "-", accessories[1].price, accessory2Qty);
                total += accessories[1].price * accessory2Qty;
            }
            
            if (accessory3Qty > 0) {
                addQuoteItem(accessories[2].id, accessories[2].code, accessories[2].name, "-", accessories[2].price, accessory3Qty);
                total += accessories[2].price * accessory3Qty;
            }
            
            // 총액 표시
            totalAmount.textContent = formatCurrency(total) + '원';
            
            // 결과 표시
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 견적 계산 버튼 이벤트
        calculateBtn.addEventListener('click', calculateQuote);

        // 견적 항목 추가
        function addQuoteItem(id, code, name, spec, price, quantity) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="py-2">${name} <span class="text-gray-500">(${id})</span></td>
                <td class="py-2">${code}</td>
                <td class="py-2">${spec}</td>
                <td class="text-right py-2">${formatCurrency(price)}원</td>
                <td class="text-right py-2">${quantity}</td>
                <td class="text-right py-2">${formatCurrency(price * quantity)}원</td>
            `;
            quoteItems.appendChild(row);
        }

        // 금액 포맷
        function formatCurrency(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // 고객 정보 유효성 검사
        function validateCustomerInfo() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            const validationError = document.getElementById('validationError');
            
            // 고객명 검사
            if (!customerName || customerName.length < 2) {
                validationError.textContent = '고객명은 2글자 이상 입력해주세요';
                validationError.style.display = 'block';
                return false;
            }
            
            // 연락처 검사 (한국 전화번호 패턴)
            const phonePattern = /^(01[016789]|02|0[3-9][0-9])-[0-9]{3,4}-[0-9]{4}$/;
            if (!customerPhone) {
                validationError.textContent = '연락처를 입력해주세요';
                validationError.style.display = 'block';
                return false;
            }
            
            if (!phonePattern.test(customerPhone)) {
                validationError.textContent = '연락처 형식이 올바르지 않습니다 (예: 010-1234-5678)';
                validationError.style.display = 'block';
                return false;
            }
            
            // 이메일 검사
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!customerEmail) {
                validationError.textContent = '이메일을 입력해주세요';
                validationError.style.display = 'block';
                return false;
            }
            
            if (!emailPattern.test(customerEmail)) {
                validationError.textContent = '올바른 이메일 형식을 입력해주세요';
                validationError.style.display = 'block';
                return false;
            }
            
            validationError.style.display = 'none';
            return true;
        }

        // 견적 데이터 수집 함수
        function collectQuoteData() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            
            // 견적 항목들 수집
            const items = [];
            const rows = quoteItems.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.cells;
                if (cells.length >= 6) {
                    items.push({
                        name: cells[0].textContent.trim(),
                        code: cells[1].textContent.trim(),
                        spec: cells[2].textContent.trim(),
                        unitPrice: cells[3].textContent.replace(/[^\d]/g, ''),
                        quantity: cells[4].textContent.trim(),
                        amount: cells[5].textContent.replace(/[^\d]/g, '')
                    });
                }
            });
            
            return {
                customerName: customerName,
                email: customerEmail,
                phone: customerPhone,
                items: items,
                totalAmount: totalAmount.textContent.replace(/[^\d]/g, ''),
                privacyConsent: true
            };
        }

        // 이메일 발송 기능
        async function handleEmailSend() {
            // 고객 정보 유효성 검사
            if (!validateCustomerInfo()) {
                return;
            }
            
            const emailBtn = document.getElementById('emailBtn');
            emailBtn.disabled = true;
            emailBtn.textContent = '발송 중...';
            
            try {
                // 견적 데이터 수집
                const quoteData = collectQuoteData();
                
                // 구글 앱스 스크립트로 발송 (form 형태로 전송)
                const formData = new FormData();
                formData.append('data', JSON.stringify(quoteData));
                
                const response = await fetch('https://script.google.com/macros/s/AKfycbyq6OwbfmYR172UArM7r8jf3nqBFbzx8dyMYFgtCMezHj5VpgSrZLhD8NZDHV1qI585Xg/exec', {
                    method: 'POST',
                    body: formData
                });
                
                // 일단 성공으로 처리 (CORS 때문에 응답 확인 어려움)
                alert('✅ 견적서 발송 요청이 완료되었습니다!\n이메일을 확인해주세요.\n\n만약 이메일이 오지 않으면 입력 정보를 다시 확인해주세요.');
                
            } catch (error) {
                console.error('Error:', error);
                
                // 에러가 나도 실제로는 발송되었을 수 있음
                const confirmSend = confirm('⚠️ 네트워크 오류가 발생했지만 견적서가 발송되었을 수 있습니다.\n\n이메일을 확인해보시겠어요?\n\n확인: 이메일 체크\n취소: 다시 시도');
                
                if (!confirmSend) {
                    emailBtn.disabled = false;
                    emailBtn.textContent = '견적서 이메일 발송';
                    return;
                }
            } finally {
                emailBtn.disabled = false;
                emailBtn.textContent = '견적서 이메일 발송';
            }
        }

        // 새 견적 작성
        function handleNewQuote() {
            // 추가된 매트들 제거 (첫 번째만 남기기)
            const matSelections = document.getElementById('matSelections');
            while (matSelections.children.length > 1) {
                matSelections.removeChild(matSelections.lastChild);
            }
            
            resultContainer.classList.add('hidden');
            // 고객 정보 입력 폼 리셋
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('validationError').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 이메일 발송 버튼 이벤트
        emailBtn.addEventListener('click', handleEmailSend);

        // 새 견적 작성 버튼 이벤트
        newQuoteBtn.addEventListener('click', handleNewQuote);

        // 연락처 자동 하이픈 추가 기능
        document.getElementById('customerPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, ''); // 숫자만 남기기
            
            if (value.length >= 3) {
                if (value.length <= 7) {
                    // 010-1234 형태
                    value = value.substring(0, 3) + '-' + value.substring(3);
                } else {
                    // 010-1234-5678 형태
                    value = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7, 11);
                }
            }
            
            e.target.value = value;
        });
    </script>
</body>
</html>
